<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.csp.barcodeManaga.ex.dao.PickingDao">

	<!-- 自定义结果集,可以将sql语句查询的Resultset结果集与实体类一一对应 -->
	<resultMap type="com.csp.barcodeManaga.entity.Picking" id="picking">
		<!-- 用于主键的映射 -->
		<!-- <id column="id" property="id" javaType="int" /> -->

		<result column="TAPE_ID" property="tapeId" javaType="java.lang.String"
			jdbcType="VARCHAR" />
		<result column="BIN_ID" property="binId" javaType="java.lang.String"
			jdbcType="VARCHAR" />
		<result column="DIE_QTY" property="qty" javaType="java.lang.String"
			jdbcType="VARCHAR" />
		<result column="MATERIAL_NAME" property="materialName"
			javaType="java.lang.String" jdbcType="VARCHAR" />
		<result column="LOT_HEADER" property="lotHeader" javaType="java.lang.String"
			jdbcType="VARCHAR" />
		<result column="CREATETIME" property="createTime" javaType="java.lang.String"
			jdbcType="VARCHAR" />
		<result column="CREATETIMESTAMP" property="createTimeStamp"
			javaType="java.util.Date" jdbcType="VARCHAR" />
		<result column="OUTTIME" property="outTime" javaType="java.util.Date"
			jdbcType="VARCHAR" />
		<result column="ODD" property="odd" javaType="java.util.Date"
			jdbcType="VARCHAR" />
		<result column="qr_Split" property="qrSplit" javaType="java.lang.String"
			jdbcType="VARCHAR" />
		<result column="qr_Id_Sec" property="qrIdSec" javaType="java.lang.String"
			jdbcType="VARCHAR" />
		<result column="prd_String" property="rpdString" javaType="java.lang.String"
			jdbcType="VARCHAR" />

	</resultMap>
	<!--手选接收 -->
	<insert id="saveBarcode" parameterType="java.util.List"
		useGeneratedKeys="false">
		insert into
		sys_psl.CSP_PICKING
		(TAPE_ID,BIN_ID,QTY,MATERIALNAME,LOT_HEADER,CREATETIME,CREATETIMESTAMP,FLAG,PFLAG,workId,odd)
		<foreach collection="list" item="picking" index="index"
			separator="union all">
			(SELECT
			#{picking.tapeId,jdbcType=VARCHAR},
			to_number(#{picking.binId,jdbcType=VARCHAR}),
			to_number(#{picking.qty,jdbcType=VARCHAR}),
			#{picking.materialName,jdbcType=VARCHAR},
			#{picking.lotHeader,jdbcType=VARCHAR},
			to_date(#{picking.createTime,jdbcType=VARCHAR},'YYYY-MM-DD
			hh24:mi:ss'),
			sysdate,0,0 ,
			#{picking.workId,jdbcType=VARCHAR},
			#{picking.odd,jdbcType=VARCHAR} FROM DUAL)
		</foreach>
	</insert>

	<!-- csp卷轴未入库。 -->
	<select id="selBarcode" resultType="java.lang.String" resultMap="picking">
		select * from V_c_tape_no_warehouse where
		tape_id=#{tapeId,jdbcType=VARCHAR}
	</select>

	<!-- csp卷轴未入库。 -->
	<select id="selBarcode1" resultType="java.lang.String"
		resultMap="picking">
		select tape_Id from SYS_PSL.CSP_PICKING where
		tape_id=#{tapeId,jdbcType=VARCHAR}
	</select>

	<!-- 查询手选接收数据 -->
	<select id="selPicking" resultType="java.lang.String" resultMap="picking">
		select * from sys_psl.csp_picking where odd=
		(select odd from
		sys_psl.csp_picking where
		tape_id=#{tapeId,jdbcType=VARCHAR})
	</select>

	<!-- 查询IPQC接收数据 -->
	<select id="selIpqc" resultType="java.lang.String" resultMap="picking">
		select * from sys_psl.csp_ipqc where odd=
		(select odd from
		sys_psl.csp_picking where
		tape_id=#{tapeId,jdbcType=VARCHAR})
	</select>

	<!-- ipqc接收 -->
	<insert id="saveIpqc" parameterType="java.util.List"
		useGeneratedKeys="false">
		insert into
		sys_psl.CSP_ipqc
		(TAPE_ID,BIN_ID,QTY,MATERIALNAME,LOT_HEADER,CREATETIME,CREATETIMESTAMP,FLAG,PFLAG,workId,odd)
		<foreach collection="list" item="picking" index="index"
			separator="union all">
			(SELECT
			#{picking.tapeId,jdbcType=VARCHAR},
			to_number(#{picking.binId,jdbcType=VARCHAR}),
			to_number(#{picking.qty,jdbcType=VARCHAR}),
			#{picking.materialName,jdbcType=VARCHAR},
			#{picking.lotHeader,jdbcType=VARCHAR},
			to_date(#{picking.createTime,jdbcType=VARCHAR},'YYYY-MM-DD
			hh24:mi:ss'),
			sysdate,0,0 ,
			#{picking.workId,jdbcType=VARCHAR},
			#{picking.odd,jdbcType=VARCHAR} FROM DUAL)
		</foreach>
	</insert>

	<!-- ipqc接收 -->
	<insert id="savePack" parameterType="java.util.List"
		useGeneratedKeys="false">
		insert into
		sys_psl.CSP_PACK
		(TAPE_ID,BIN_ID,QTY,MATERIALNAME,LOT_HEADER,CREATETIME,CREATETIMESTAMP,FLAG,PFLAG,workId,odd)
		<foreach collection="list" item="picking" index="index"
			separator="union all">
			(SELECT
			#{picking.tapeId,jdbcType=VARCHAR},
			to_number(#{picking.binId,jdbcType=VARCHAR}),
			to_number(#{picking.qty,jdbcType=VARCHAR}),
			#{picking.materialName,jdbcType=VARCHAR},
			#{picking.lotHeader,jdbcType=VARCHAR},
			to_date(#{picking.createTime,jdbcType=VARCHAR},'YYYY-MM-DD
			hh24:mi:ss'),
			sysdate,0,0 ,
			#{picking.workId,jdbcType=VARCHAR},
			#{picking.odd,jdbcType=VARCHAR} FROM DUAL)
		</foreach>
	</insert>

	<update id="updateJiechu" parameterType="com.csp.barcodeManaga.entity.BarcodeCl">
		update
		sys_psl.csp_picking set flag='0'where
		tape_id=#{tapeId,jdbcType=VARCHAR}
	</update>

	<!-- 查询IPQC接收数据 -->
	<select id="barcodeVerify" resultType="java.lang.String"
		resultMap="picking">
		select QR_split qrSplit,
		qr_id_sec qrIdSec,rpd_string
		rpdString
		from
		V_TEMPLET_RULES@T_JPMAIN
		where templet_id =
		(select
		templet_id
		from
		(select templet_id, rownum
		from
		T_BARCODE_REEL@T_JPMAIN t
		where
		barcode_reel_id =
		#{tapeId,jdbcType=VARCHAR}
		order by
		barcode_reel_rrn
		desc
		)
		where rownum = 1)
	</select>

</mapper>