<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jn.File.export.dao.MainRuleDao">

	<!-- 自定义结果集,可以将sql语句查询的Resultset结果集与实体类一一对应 -->
	<resultMap type="com.jn.File.entity.MainRule" id="myMainRule">
		<!-- 用于主键的映射 -->
		<id column="id" property="id" javaType="int" />
		<!-- 其他列映射都是用result -->
		<result column="binid" property="binid" javaType="java.lang.String"
			jdbcType="VARCHAR" />
		<result column="nLight" property="nLight" javaType="java.lang.String"
			jdbcType="VARCHAR" />
		<result column="binMain" property="binMain" javaType="java.lang.String"
			jdbcType="VARCHAR" />
		<result column="binSub" property="binSub" javaType="java.lang.String"
			jdbcType="VARCHAR" />
		<result column="binSub_Model1" property="binSub_Model1"
			javaType="java.lang.String" jdbcType="VARCHAR" />
		<result column="binSub_Model2" property="binSub_Model2"
			javaType="java.lang.String" jdbcType="VARCHAR" />
		<result column="volID" property="volID" javaType="java.lang.String"
			jdbcType="VARCHAR" />

	</resultMap>
	<!-- 针对于不定向条件的查询，关键在于SQL语句的拼接，根据当前实际的参数来拼接SQL -->
	<insert id="save">
		insert into TBLBINRULESEXTEND_TMP
		values(#{binid,jdbcType=VARCHAR},#{nLight,jdbcType=VARCHAR},#{binMain,jdbcType=VARCHAR}
		,#{binSub,jdbcType=VARCHAR},#{binSub_Model1,jdbcType=VARCHAR},#{binSub_Model2,jdbcType=VARCHAR}
		,#{volID,jdbcType=VARCHAR})
	</insert>
	<delete id="delAll">
		TRUNCATE TABLE TBLBINRULESEXTEND_TMP
	</delete>
	<select id="verTime" resultType="java.lang.String">
		SELECT
		DISTINCT
		SUBSTRING(tp.volID,CHARINDEX('_',tp.volID)+1,255) ver
		FROM
		tblBinRulesExtend_Tmp AS tp
	</select>
	<insert id="addBin">
		<!-- set identity_insert tblBinRulesExtend on -->
		INSERT
		INTO
		tblBinRulesExtend(binid,nLight,binMain,binSub,binSub_Model1,binSub_Model2,volID)
		SELECT binid,nLight,binMain,binSub,binSub_Model1,binSub_Model2,volID
		FROM tblBinRulesExtend_Tmp
	</insert>
	<select id="main" resultMap="myMainRule">
		SELECT * from TBLBINRULESEXTEND  WHERE volID LIKE  #{volID,jdbcType=VARCHAR} + '%'
	</select>
</mapper>