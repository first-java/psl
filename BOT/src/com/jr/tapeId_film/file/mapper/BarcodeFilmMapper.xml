<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jr.tapeId_film.file.dao.BarcodeFilmDao">

	<!-- 自定义结果集,可以将sql语句查询的Resultset结果集与实体类一一对应 -->
	<resultMap type="com.jr.tapeId_film.entity.BarcodeFilm" id="myPsp">
		<!-- 其他列映射都是用result -->
		<result column="tapeId" property="tapeId" javaType="java.lang.String"
			jdbcType="VARCHAR" />
		<result column="creater" property="creater" javaType="java.lang.String"
			jdbcType="VARCHAR" />
		<result column="createtime" property="createtime" javaType="java.lang.String"
			jdbcType="VARCHAR" />
		<result column="filmNo" property="filmNo" javaType="java.lang.String"
			jdbcType="VARCHAR" />
		<result column="quantity" property="quantity" javaType="java.lang.String"
			jdbcType="VARCHAR" />
		<result column="BIN_UNIT_ID" property="binUnitId" javaType="java.lang.String"
			jdbcType="VARCHAR" />
		<result column="REMARK" property="remark" javaType="java.lang.String"
			jdbcType="VARCHAR" />
		<result column="ROOT_LOT_ID" property="rootlotid" javaType="java.lang.String"
			jdbcType="VARCHAR" />
		<result column="LOT_HEAD" property="lotHead" javaType="java.lang.String"
			jdbcType="VARCHAR" />
		<result column="DIE_COUNT" property="dieCount" javaType="java.lang.String"
			jdbcType="VARCHAR" />
	</resultMap>
	<!--查询卷轴号是否存在 -->
	<select id="findTapeId" resultMap="myPsp">
		select * from
		Lbmycim2.Tape_Unit_Data where tape_id=#{tapeId,jdbcType=VARCHAR} order
		by createtime desc
	</select>

	<!--输入卷轴号查询级别，批次头 -->
	<select id="tapeIdFindMaterialName" resultMap="myPsp">
		select * from
		Lbmycim2.Bin_Unit_Data  where bin_unit_id in
		(select film_id from
		Lbmycim2.Film_Tape_Relation  where tape_id
		=#{tapeId,jdbcType=VARCHAR})order by createtime desc
	</select>

	<!--输入蓝膜号查级别和批次头 -->
	<select id="filmIdFindMaterialName" resultMap="myPsp">
		select * from
		Lbmycim2.Bin_Unit_Data  where bin_unit_id=#{binUnitId,jdbcType=VARCHAR}
		order by createtime desc
	</select>
	<!--控制数量 -->
	<select id="findQty" resultMap="myPsp">
		select * from
		lsrm.tape_die_count@Lbmycim where lot_head=#{lotHead,jdbcType=VARCHAR}
	</select>
	<!-- 保存补料数据 -->
	<insert id="save" parameterType="com.jr.tapeId_film.entity.BarcodeFilm">
		insert into
		sys_psl.tapeId_film
		(tapeId,filmNo,quantity,creater,createtime,id)
		values(#{tapeId,jdbcType=VARCHAR},#{filmNo,jdbcType=VARCHAR},#{quantity,jdbcType=VARCHAR}
		,#{creater,jdbcType=VARCHAR},to_char(sysdate,'YYYY/MM/DD
		hh24:mi:ss'),#{id,jdbcType=VARCHAR})
	</insert>

	<!--用卷轴查询明细 -->
	<select id="tapeIdSelect" resultMap="myPsp">
		select * from
		sys_psl.tapeId_film where tapeId=#{tapeId,jdbcType=VARCHAR}

	</select>
	<!-- 用时间查询 -->
	<select id="timeSelect" resultMap="myPsp">
		select * from
		sys_psl.tapeId_film where
		createtime>=#{startTime,jdbcType=VARCHAR}
		AND
		CREATETIME&lt;=#{endTime,jdbcType=VARCHAR}
	</select>
	<!-- 用蓝膜查询 -->
	<select id="filmNoSelect" resultMap="myPsp">
		select * from
		sys_psl.tapeId_film where
		filmNo=#{filmNo,jdbcType=VARCHAR}
	</select>
</mapper>