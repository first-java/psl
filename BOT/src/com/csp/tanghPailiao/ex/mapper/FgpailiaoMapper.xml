<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.csp.tanghPailiao.ex.dao.FgpailiaoDao">

	<!-- 自定义结果集,可以将sql语句查询的Resultset结果集与实体类一一对应 -->
	<resultMap type="com.csp.tanghPailiao.entity.Fgpailiao" id="cc">
		<!-- 用于主键的映射 -->
		<!-- <id column="id" property="id" javaType="int" /> -->
		<result column="LOTID" property="lotId" javaType="java.lang.String"
			jdbcType="VARCHAR" />
		<result column="EACHWEIGHT" property="eachWeight" javaType="java.lang.String"
			jdbcType="VARCHAR" />
		<result column="BARCODE" property="barcode" javaType="java.lang.String"
			jdbcType="VARCHAR" />
		<result column="CREATTIME" property="creattime" javaType="java.util.Date"
			jdbcType="VARCHAR" />
	</resultMap>

	<select id="selBag" resultType="java.lang.String" resultMap="cc">
		select * from sys_psl.csp_pl_fgshelf_goods where bagname=(
		select
		min(bagname) from sys_psl.csp_pl_fgshelf_goods
		where
		substr(lotid,0,7) =
		(select lottype
		from SYS_PSL.CSP_FG_EQPT where
		fglotid=#{lotId,jdbcType=VARCHAR})
		and status='0'
		and flag is null
		<if test="bin != null and bin !='' ">
			and leixing ='底板散芯'
		</if>
		)
		and
		leixing not
		in('分光地料','分光废料','报废BIN')

	</select>
	<!--查询分光自动派料打印信息 -->
	<select id="selBagLabel" resultType="java.lang.String"
		resultMap="cc">
		select * from SYS_PSL.CSP_FG_EQPT fge, SYS_PSL.CSP_CALCULATE
		cal,SYS_PSL.CSP_PL_FGSHELF_GOODS g
		where
		fge.fglotid=#{fgLotId,jdbcType=VARCHAR}
		and
		g.bagname=#{bagName,jdbcType=VARCHAR}
		and
		cal.lothead=fge.lottype
	</select>

	<insert id="saveFgLabel" parameterType="com.csp.tanghPailiao.entity.Fgpailiao">
		insert into
		SYS_PSL.CSP_FG_EQPTpro
		(createtime,fglotid,bagname,id,lottype,bin)
		values(
		sysdate,#{fgLotId,jdbcType=VARCHAR},
		#{bagName,jdbcType=VARCHAR},#{id,jdbcType=VARCHAR},#{lotType,jdbcType=VARCHAR}
		,#{bin,jdbcType=VARCHAR})
	</insert>
	<update id="updateGoodsStatus" parameterType="com.csp.tanghPailiao.entity.Fgpailiao">
		update
		SYS_PSL.CSP_PL_FGSHELF_GOODS set status='1',
		outtime=sysdate,outworkId=#{workId,jdbcType=VARCHAR},
		chuLei=#{chuLei,jdbcType=VARCHAR} where
		bagname=#{bagName,jdbcType=VARCHAR}
	</update>

	<select id="selha" resultType="java.lang.String" resultMap="cc">
		select * from SYS_PSL.CSP_PL_FGSHELF_GOODS where
		lotid=#{lotId,jdbcType=VARCHAR}
	</select>

	<select id="queCaseno" resultType="java.lang.String" resultMap="cc">
		select * from ( select
		DISTINCT SHELFNAME,CASENO,
		deposit,
		regexp_substr(PRODUCT,'[^,]+', 1, Level,'i') PRODUCT
		from
		SYS_PSL.CSP_PL_FGSHELF
		connect by Level &lt;= LENGTH(PRODUCT) -
		LENGTH(REGEXP_REPLACE(PRODUCT, ',',
		''))
		+ 1 ) where
		deposit=#{deposit,jdbcType=VARCHAR}
		AND
		SUBSTR(PRODUCT,1,LENGTH(PRODUCT)) =SUBSTR
		(#{product,jdbcType=VARCHAR},0,LENGTH(PRODUCT))
		order by
		to_number(CASENO)
	</select>


	<select id="queYFGCaseno" resultType="java.lang.String"
		resultMap="cc">
		SELECT * FROM
		(
		SELECT shelfname,
		caseno,
		product,
		bin,
		substr(BIN, 1,
		instr(BIN, '-') -
		1) as start1,
		substr(BIN, instr(BIN,
		'-') + 1,
		length(BIN) - instr(BIN,
		'-')) as end1
		FROM (SELECT DISTINCT *
		FROM
		(select SHELFNAME,
		CASENO,
		SERI,
		WORKID,
		CREATETIME,
		regexp_substr(product, '[^,]+', 1, Level, 'i')
		product,
		STATUS,
		DEPOSIT,
		BIN,
		MAXDEPOSIT,
		QTY
		from SYS_PSL.CSP_PL_FGSHELF
		connect by Level &lt;=
		LENGTH(product) -
		LENGTH(REGEXP_REPLACE(product,
		',', '')) + 1)
		ORDER BY
		SHELFNAME, CASENO)
		WHERE deposit
		=#{deposit,jdbcType=VARCHAR}
		) X
		WHERE
		1=1
		<if test="bin != null and bin !='' ">
			and X.START1&lt;=to_number(#{bin,jdbcType=VARCHAR})
			AND
			X.END1>=to_number(#{bin,jdbcType=VARCHAR})
		</if>

		AND
		SUBSTR(PRODUCT,1,LENGTH(PRODUCT)) =SUBSTR
		(#{product,jdbcType=VARCHAR},0,LENGTH(PRODUCT))
		order by
		caseno
	</select>

	<select id="queYFGCaseno1" resultType="java.lang.String"
		resultMap="cc">
		select * from SYS_PSL.CSP_PL_FGSHELF
		where PRODUCT= '其他'
		and
		deposit =#{deposit,jdbcType=VARCHAR}
		and bin is null
	</select>

	<select id="selectBagHe" resultType="java.lang.String"
		resultMap="cc">
		select g.bagname, t.deposit, g.lotType, g.qty, g.jing_weight
		AS jingWeight
		from SYS_PSL.CSP_BAG_HEDAI t,
		sys_psl.csp_pl_fgshelf_goods g
		where g.bagname = t.bagname
		and
		t.bagname1=#{bagName,jdbcType=VARCHAR}
	</select>


</mapper>