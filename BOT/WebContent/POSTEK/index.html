<!DOCTYPE html>
<html class="signin no-js" lang="zh">
<head>
<link type="favicon" rel="shortcut icon" href="favicon.ico" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="renderer" content="webkit">
<meta charset="utf-8">
<meta name="viewport"
	content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1">
<meta name="description" content="postek browser printer">
<meta name="keywords" content="postek">
<title>POSTEK博思得_条码/RFID标签打印机_设计精湛_好用耐用</title>
<link rel="stylesheet" href="../assert/bootstrap/css/bootstrap.min.css">
<script src="../assert/js/jquery-1.11.1.min.js"></script>
<script src="../assert/js/jquery.pjax.js"></script>
<script src="../assert/js/json2.js"></script>

<style type="text/css">
html {
	overflow-x: hidden
}

.top {
	width: 100%;
	background: url(../images/top_bg.jpg) repeat-x #efefef;
	position: relative;
	z-index: 10;
}

.main-body {
	height: 100%;
	background: url(../assert/img/top_bg.jpg) repeat-x #efefef;
	position: relative;
	z-index: 10;
	line-height: 0;
}

.main-box {
	background: url(../assert/img/top_bg.jpg) repeat-x #efefef;
	position: relative;
	z-index: 10;
}

.main-center {
	padding-top: 15px;
}

.top_nav {
	width: 1020px;
	overflow: hidden;
	margin: 0 auto;
	/* padding-top: 15px; */
}

.lang-box {
	background-color: #efefef;
	position: relative;
	z-index: 10;
	margin-bottom: 40px;
}

a {
	text-decoration: none;
	color: #666;
}

a:hover {
	cursor: pointer;
	text-decoration: none;
	color: #d30a2d;
}

.btn-postek {
	font-size: 14px;
	font-family: "Microsoft YaHei";
	/**width: 30%;
			margin-top: 10px !important;
			*/
	float: left;
	border-color: #9F9D9C !important;
	background-color: #9F9D9C !important;
}

.btn-postek:hover {
	border-color: #D20B2C !important;
	background-color: #D20B2C !important;
}

.select-postek {
	font-size: 14px;
	font-family: "Microsoft YaHei";
}

.label-postek {
	text-align: right;
	line-height: 46px;
	font-family: "Microsoft YaHei";
}

.input-postek {
	font-size: 14px;
	font-family: "Microsoft YaHei";
}

.fengei-div-postek {
	height: 1px;
	margin-top: 40px;
	text-align: center;
	border-top: 1px solid #9F9D9C;
}

.fengei-span-postek {
	position: relative;
	background-color: #efefef; /*#efefef*/
	display: inline-block;
	top: -10px;
	line-height: 20px;
	padding-left: 10px;
	padding-right: 10px;
}

.p-postek {
	word-wrap: break-word;
	word-break: break-all;
	overflow: hidden;
	line-height: 100%;
}
</style>

</head>
<body class="main-body">


	<header class="panel-heading no-b text-center"
		style="font-size:30px;padding: 0;">
		<img src="../assert/img/banner.jpg" alt="" width="100%">
	</header>

	<div class="center-wrapper main-center">
		<div class="center-content">

			<div class="row no-m">
				<div
					class="col-xs-10 col-xs-offset-1 col-sm-6 col-sm-offset-2 col-md-8 col-md-offset-2">
					<div class="lang-box">
						<div style="float:right;">
							<a href="../cdfpsk_Net.html" style="margin-right:10px;"><img
								title="点击切换为调用网络打印" width="32" height="32"
								src="../assert/img/net.png" /></a> <a href="../index_cdfpsk.html"
								style="margin-right: 20px;"><img title="点击切换为调用USB打印"
								width="32" height="32" src="../assert/img/driver.png" /></a> <span><a
								href="../index.html">中文</a></span> &nbsp;&nbsp;|&nbsp;&nbsp; <span><a
								href="../index_en.html">English</a></span>
						</div>
					</div>
					<section class="panel bg-white no-b fadeIn animated"
						style="background-color: #efefef;border:none;">

						<div class="p15 main-box">
							<form id="printForm" action="#" data-parsley-validate=""
								novalidate="" role="form" method="post">

								<div class="form-group">
									<label for="printname"
										class="col-sm-2 control-label label-postek">打印机型号</label>
									<div class="form-group col-sm-10"
										style="padding-left:0;padding-right:0;">
										<select id="printname" name="printname"
											class="form-control input-lg  mb25 select-postek">
										</select>
									</div>
								</div>
								<div class="form-group">
									<label for="printWidth"
										class="col-sm-2 control-label label-postek">标签宽度</label>
									<div class="form-group col-sm-2"
										style="padding-left:0;padding-right:0;">
										<input type="number" id="printWidth" name="printWidth"
											value="" required
											class="form-control input-lg mb25 input-postek"
											placeholder="单位:dots">
									</div>
								</div>
								<div class="form-group">
									<label for="printWidth"
										class="col-sm-2 control-label label-postek">标签高度</label>
									<div class="form-group col-sm-2"
										style="padding-left:0;padding-right:0;">
										<input type="number" id="printHeight" name="printHeight"
											value="" required
											class="form-control input-lg mb25 input-postek"
											placeholder="单位:dots">
									</div>
								</div>
								<div class="form-group">
									<label for="printGap"
										class="col-sm-2 control-label label-postek">间隙/黑标高度</label>
									<div class="form-group col-sm-2"
										style="padding-left:0;padding-right:0;">
										<input type="number" id="printGap" name="printGap" value=""
											required class="form-control input-lg mb25 input-postek"
											placeholder="单位:dots">
									</div>
								</div>

								<!-- 按钮 -->
								<div class="form-group">
									<label for="printBtn"
										class="col-sm-3 control-label label-postek"></label>
									<div class="form-group col-sm-3"
										style="padding-left:0;padding-right:0;margin-top: 10px;">
										<button id="printBtn"
											class="btn btn-primary btn-lg btn-block btn-postek"
											type="button" data-loading-text="打印中...">打印</button>
									</div>
								</div>

								<div class="form-group">
									<label for="printTplBtn"
										class="col-sm-1 control-label label-postek"></label>
									<div class="form-group col-sm-3"
										style="padding-left:0;padding-right:0;margin-top: 10px;">
										<button id="printTplBtn"
											class="btn btn-primary btn-lg btn-block btn-postek"
											type="button" data-loading-text="打印模板中...">打印模板</button>
									</div>
								</div>

								<p id="tip" class="p15  p-postek"
									style="margin-top:20px; margin-left: 25%;float:left;display:none"></p>
							</form>
						</div>
						<div id="fengei" style="float:left;width: 100%;display:none; ">
							<div class="fengei-div-postek">
								<span class="fengei-span-postek">我是有底线的</span>
							</div>
						</div>
					</section>
				</div>
			</div>

		</div>
	</div>

	<script type="text/javascript">
	
		var url = "http://127.0.0.1:888/postek/print";
		var urls = "127.0.0.1:8080/img/logo1.pcx";
		$(document).ready(function() {
			$("#year").html(new Date().getFullYear());
	
			window.onscroll = function() {
				var top = document.getElementsByTagName("body")[0].scrollTop;
				if (top > window.innerHeight) {
					//tag.style.visibility = "visible";
					$("#fengei").hide();
				} else {
					//tag.style.visibility = "hidden";
					$("#fengei").fadeIn();
				}
			}
	
			$("#printBtn").on("click", function() {
				if ($("#printlabel").val().length == 0 || $("#printWidth").val().length == 0 || $("#printHeight").val().length == 0 || $("#printGap").val().length == 0) {
					$("#tip").html("请输入完整信息").css("color", "#D20B2C");
					$("#tip").fadeIn();
					$("#tip").delay(3000).hide(0);
					return;
				}
	
				$("#printBtn").text("正在打印中。。。");
				$("#printBtn").attr("disabled", "disabled");
	
				var data = {};
				data.printname = $("#printname").val();
				data.printlabel = $("#printlabel").val();
				data.reqParam = "2";
				data.lang = "zh";
	
				var printparamsJsonArray = {};
				printparamsJsonArray.OpenPort = $("#printname").val();
				printparamsJsonArray.PTK_ClearBuffer = "";
				printparamsJsonArray.PTK_SetPrintSpeed = "4";
				printparamsJsonArray.PTK_SetDarkness = "10";
				printparamsJsonArray.PTK_SetLabelHeight = $("#printHeight").val() + "," + $("#printGap").val() + ",0,false";
				printparamsJsonArray.PTK_SetLabelWidth = $("#printWidth").val();
				printparamsJsonArray.PTK_DrawTextEx = "80,168,0,3,1,1,N," + $("#printlabel").val() + ",0";
				printparamsJsonArray.PTK_PrintLabel = "1,1";
				printparamsJsonArray.ClosePort = "";
	
				data.printparams = '[' + JSON.stringify(printparamsJsonArray) + ']';
				//这里是请求打印机的参数（包括函数名和参数）
	
				$.ajax({
					type : "POST",
					url : url,
					data : data,
					dataType : "json",
					timeout : 5000, // in milliseconds
					success : function(result) {
						//var retdata = JSON.parse (result);
						if (result.retval == '0') {
							$("#tip").html("发送成功").css("color", "green");
							$("#tip").fadeIn();
							$("#printBtn").text("打印");
							$("#printBtn").removeAttr("disabled");
							$("#tip").delay(3000).hide(0);
						} else {
							$("#tip").html("发送失败，返回结果：" + result.msg).css("color", "#D20B2C");
							$("#tip").fadeIn();
							$("#printBtn").text("打印");
							$("#printBtn").removeAttr("disabled");
							$("#tip").delay(3000).hide(0);
						}
					},
					error : function(request, status, err) {
						$("#tip").html("请求失败，请重试").css("color", "#D20B2C");
						$("#tip").fadeIn();
						$("#printBtn").text("打印");
						$("#printBtn").removeAttr("disabled");
						$("#tip").delay(3000).hide(0);
					}
				});
			});
	
	
			$("#printTplBtn").on("click", function() {
	
				$("#printTplBtn").text("正在打印模板中。。。");
				$("#printTplBtn").attr("disabled", "disabled");
	
				/* for (var i = 0; i < 3; i++) { */
				var data = {};
				data.printname = $("#printname").val();
				data.printlabel = $("#printlabel").val();
				data.reqParam = "2";
				data.lang = "zh";
	
				var printparamsJsonArray = [];
	
				printparamsJsonArray.push({
					"OpenPort" : $("#printname").val()
				}); //打开打印机
				printparamsJsonArray.push({
					"PTK_ClearBuffer" : ""
				}); //清除缓存
				printparamsJsonArray.push({
					"PTK_SetDirection" : 'B'
				}); //设置打印方向
				printparamsJsonArray.push({
					"PTK_SetPrintSpeed" : "4"
				}); //设置打印速度
				printparamsJsonArray.push({
					"PTK_SetDarkness" : "10"
				}); //设置打印黑度
				printparamsJsonArray.push({
					"PTK_PcxGraphicsDel" : "*"
				}); //删除所有图形
				printparamsJsonArray.push({
					"PTK_SetLabelHeight" : "550,240,0,false"
				}); //设置标签纸高度  间隙高度  ！必须设置
				printparamsJsonArray.push({
					"PTK_SetLabelWidth" : "900" //条码整体偏移，数字大往右移
				}); //设置标签纸高度  ！必须设置
				printparamsJsonArray.push({
					"PTK_DrawRectangle" : "1,1,3,900,550" //1.起点的x坐标，2.起点的y坐标，3.边框的粗细，4.终点的x坐标，5.终点的y坐标
				}); //画矩形    x从右下角往左，y从右下角往上
				/* printparamsJsonArray.push({
					"PTK_DrawBarcode" : "90,30,0,1,2,2,30,B,98765431" + i //第一位是条码偏移。数字大往右移30是条码高度
				}); */ //打印一个一维码   1.设置x的坐标2.设置y的坐标，3.条码打印的方向 4.打印的条码类型 
				/* 	printparamsJsonArray.push({
						"PTK_DrawBarcode" : "270,30,0,1,2,2,30,B,FN-B-3-F3-T" //第一位是条码偏移。数字大往右移30是条码高度
					}); */ //打印一个一维码
				/* printparamsJsonArray.push({
					"PTK_DrawLineOr" : "58,111,500,3"
				}); */ //画直线
	
				printparamsJsonArray.push({
					"PTK_DrawTextTrueTypeW" : "200,20,40,0,黑体,1,700,0,0,0,A1,LatticePower(JiangXi)Corporation"
				}); //打印文字
				printparamsJsonArray.push({
					"PTK_DrawTextTrueTypeW" : "200,60,36,0,黑体,1,700,0,0,0,A2,Item:XFD-B-5-J-V0"
				});
				printparamsJsonArray.push({
					"PTK_DrawBarcode" : "200,100,0,1,2,2,40,N,XFD-B-5-J-V0" //第一位是条码偏移。数字大往右移30是条码高度
				}); //打印一个一维码
				printparamsJsonArray.push({
					"PTK_DrawTextTrueTypeW" : "200,150,36,0,黑体,1,700,0,0,0,A3,Reel ID:AFN00000034"
				});
				printparamsJsonArray.push({
					"PTK_DrawBarcode" : "200,190,0,1,2,2,40,N,AFN00000034" //第一位是条码偏移。数字大往右移30是条码高度
				}); //打印一个一维码
				printparamsJsonArray.push({
					"PTK_DrawTextTrueTypeW" : "200,230,36,0,黑体,1,700,0,0,0,A4,Qty:3000"
				}); //打印文字
				printparamsJsonArray.push({
					"PTK_DrawBarcode" : "200,270,0,1,2,2,40,N,3000" //第一位是条码偏移。数字大往右移第7位是条码高度
				}); //打印一个一维码
				printparamsJsonArray.push({
					"PTK_DrawTextTrueTypeW" : "480,310,36,0,黑体,1,700,0,0,0,A5,6FDP2FCA"
				}); //打印文字
				printparamsJsonArray.push({
					"PTK_DrawTextTrueTypeW" : "480,350,36,0,黑体,1,700,0,0,0,A6,Date:2018-09-28"
				}); //打印文字
				
				/* printparamsJsonArray.push({
					"PTK_DrawTextTrueTypeW" : "200,20,36,0,黑体,1,700,0,0,0,A1,LatticePower(JiangXi)Corporation"
				}); */ //打印文字
				/* printparamsJsonArray.push({
					"PTK_DrawBar2D_Pdf417" : "80,180,400,300,0,0,3,7,10,2,0,0,123456789"
				});  */ //打印PDF417码
	
				/* printparamsJsonArray.push({
					"PTK_DrawBar2D_Pdf417" : "80,180,400,300,0,0,3,7,10,2,0,0,123456789"
				});  */ //打印PDF417码
				printparamsJsonArray.push({
					"PTK_PcxGraphicsDownload" : "logo1," + urls + ""
				});
	
				printparamsJsonArray.push({
					"PTK_DrawPcxGraphics" : "1,1,logo1"
				}); //打印指定图形        
				/* printparamsJsonArray.push({
					"PTK_PrintPCX" : "100,100,C:\\Users\\pengs\\Workspaces\\MyEclipse 2017 CI\\barcode_film\\WebRoot\\POSTEK\\logo.pcx"
				}); */
				//PTK_PcxGraphicsDownload()
	
				/* printparamsJsonArray.push({
					"PTK_DrawBar2D_QR" : "80,28,360,360,2,3,2,0,0,PN:FN03B##MPQ:3000##DC:2.9-3.9V"
				}); */ //打印二维码 
				/* printparamsJsonArray.push({
					"PTK_DrawTextTrueTypeW" : "80,230,19,0,Arial,1,700,0,0,0,A3,Use different ID_NAME for different Truetype font objects"
				}); */ //用Windows字体打印文字
				printparamsJsonArray.push({
					"PTK_EnableBackFeed" : 0
				});
				printparamsJsonArray.push({
					"PTK_PrintLabel" : "1,1"
				});
	
				//设置打印份数  复制份数  ！必须设置
				printparamsJsonArray.push({
					"ClosePort" : ""
				});
	
				data.printparams = JSON.stringify(printparamsJsonArray);
				//sleep(1000);
				$.ajax({
					type : "POST",
					url : url,
					data : data,
					dataType : "json",
					async : false,
					timeout : 5000, // in milliseconds
					success : function(result) {
						//var retdata = JSON.parse (result);
						if (result.retval == '0') {
							$("#tip").html("发送成功").css("color", "green");
							$("#tip").fadeIn();
							$("#printTplBtn").text("打印模板");
							$("#printTplBtn").removeAttr("disabled");
							$("#tip").delay(3000).hide(0);
						} else {
							$.ajax({
								type : "POST",
								url : "postek.action?methodstr=execute",
								data : {
									"test" : 4
								},
								dataType : "json",
								async : false,
								timeout : 5000, // in milliseconds
							});
	
							$("#tip").html("发送失败，返回结果：" + result.msg).css("color", "#D20B2C");
							$("#tip").fadeIn();
							$("#printBtn").text("打印模板");
							$("#printBtn").removeAttr("disabled");
							$("#tip").delay(3000).hide(0);
						}
					},
					error : function() {
						$("#tip").html("请求失败，请重试").css("color", "#D20B2C");
						$("#tip").fadeIn();
						$("#printTplBtn").text("打印模板");
						$("#printTplBtn").removeAttr("disabled");
						$("#tip").delay(3000).hide(0);
					}
				});
			/* } */
			});
			/* function sleep(numberMillis) {
				var now = new Date();
				var exitTime = now.getTime() + numberMillis;
				while (true) {
					now = new Date();
					if (now.getTime() > exitTime)
						return;
				}
			} */
	
			$("#username").focus();
			getPrinterList();
	
		});
	
		function getPrinterList() {
			//$("#printBtn").text("正在获取打印机中。。。");
			$("#printBtn").attr("disabled", "disabled");
	
			var data = {};
			data.printname = $("#printname").val();
			data.reqParam = "0";
			data.lang = "zh";
	
			$.ajax({
				type : "POST",
				url : url,
				data : data,
				dataType : "json",
				timeout : 5000, // in milliseconds
				success : function(result) {
					if (result == null || result.length == 0) {
						$("#tip").html("获取打印机失败，请刷新页面重试").css("color", "#D20B2C");
						$("#tip").fadeIn();
						$("#printBtn").text("打印");
						$("#printTplBtn").attr("disabled", "disabled");
						$("#tip").delay(3000).hide(0);
	
					} else {
						$("#printname").empty();
						//var retdata = JSON.parse (result);
						for (var i in result) {
							$("#printname").append("<option value='" + result[i].printName + "'>" + result[i].printName + "</option>");
						}
						$("#tip").hide();
						$("#printBtn").text("打印");
						$("#printBtn").removeAttr("disabled")
					}
				},
				error : function() {
					$("#tip").html("获取打印机失败，请刷新页面重试").css("color", "#D20B2C");
					$("#tip").fadeIn();
					$("#printBtn").text("打印");
					$("#printTplBtn").attr("disabled", "disabled");
					$("#tip").delay(3000).hide(0);
				}
			});
		}
	</script>
</body>
</html>